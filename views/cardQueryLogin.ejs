<!DOCTYPE html>
<html lang="zh-cmn-Hans">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0,viewport-fit=cover">
    <title>登录</title>
    <!-- <link rel="stylesheet" href="./css/weui.css" />
    <link rel="stylesheet" href="./css/example.css" /> -->
    <link href="css/style.css" rel="stylesheet">
    <link rel="stylesheet" href="./css/weui.min.css" />
    <style>
        body {
            font-family: Roboto-Regular,Roboto,Helvetica Neue,Helvetica,Tahoma,Arial,"Noto Sans",'Microsoft Yahei',SimSun,sans-serif !important;
            font-size: 12px;
            background-color: #f8f8f8;
            margin: 0;
            padding: 0
        }
    </style>
</head>

<body ontouchstart>
    <div style="display: flex; min-height: 100vh;align-items: center;">
        <div style="width:100%;max-width: 400px; margin: auto;">
            <div>
                <div style="background-color: rgb(255, 255, 255);">
                    <div style="display: flex; align-items: flex-end; padding: 3px 10px; border-bottom: 1px solid rgb(221, 221, 221);">
                        <input id="username" name="username" value="" placeholder="请输入登录账号" style="width: 100%; height: 40px; font-size: 16px; border: none; outline: none;">
                    </div>
                    <div style="display: flex; align-items: flex-end; padding: 3px 10px; border-bottom: 1px solid rgb(221, 221, 221);">
                        <input id="password" type="password" name="password" value="" placeholder="请输入密码" style="width: 100%; height: 40px; font-size: 16px; border: none; outline: none;">
                    </div>
                </div>
                <div style="padding-left: 10%; padding-right: 10%;">
                    <div style="position: relative; cursor: pointer; overflow: visible; display: table; height: auto; width: auto; margin-top: 10px;">
                        <div class="weui-cells_checkbox">
                            <label class="weui-cell weui-check__label" for="remember" style="padding:0">
                                <div class="weui-cell__hd">
                                    <input type="checkbox" checked="checked" class="weui-check" name="checkbox" id="remember">
                                    <i class="weui-icon-checked"></i>
                                </div>
                                <div class="weui-cell__bd" style="font-size:14px">
                                    <p>记住密码</p>
                                </div>
                            </label>
                        </div>
                    </div>
                    <div style="color: rgba(0, 0, 0, 0.87); background-color: rgb(255, 255, 255); transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms; box-sizing: border-box; font-family: 微软雅黑; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); box-shadow: none; border-radius: 2px; display: inline-block; min-width: 88px; width: 100%; margin-top: 10px;">
                        <button id="btnLogin" tabindex="0" type="button" style="border: 1px solid; box-sizing: border-box; display: inline-block; font-family: 微软雅黑; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); cursor: pointer; text-decoration: none; margin: 0px; padding: 0px; outline: none; font-size: inherit; font-weight: inherit; transform: translate(0px, 0px); position: relative; min-width: 88px; height: 36px; line-height: 36px; width: 100%; border-radius: 4px; transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms; background-color: rgb(238, 238, 238); color: rgb(33, 150, 243); text-align: center;">
                            <div>
                                <div style="height: 36px; border-radius: 4px; transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms; top: 0px;">
                                    <span style="position: relative; opacity: 1; font-size: 14px; letter-spacing: 0px; text-transform: uppercase; font-weight: 500; margin: 0px; padding-left: 16px; padding-right: 16px; color: rgb(33, 150, 243); user-select: none;">登录</span>
                                </div>
                            </div>
                        </button>
                    </div>

                    <!-- <div style="color: rgba(0, 0, 0, 0.87); background-color: rgb(255, 255, 255); transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms; box-sizing: border-box; font-family: 微软雅黑; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); box-shadow: none; border-radius: 2px; display: inline-block; min-width: 88px; width: 100%; margin-top: 10px;">
                        <button id="wx_login" tabindex="0" type="button" style="border: 1px solid; box-sizing: border-box; display: inline-block; font-family: 微软雅黑; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); cursor: pointer; text-decoration: none; margin: 0px; padding: 0px; outline: none; font-size: inherit; font-weight: inherit; transform: translate(0px, 0px); position: relative; min-width: 88px; height: 36px; line-height: 36px; width: 100%; border-radius: 4px; transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms; background-color: #09bb07; color: #09bb07; text-align: center;">
                            <div>
                                <div style="height: 36px; border-radius: 4px; transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms; top: 0px;">
                                    <span style="position: relative; opacity: 1; font-size: 14px; letter-spacing: 0px; text-transform: uppercase; font-weight: 500; margin: 0px; padding-left: 16px; padding-right: 16px; color: #FFF; user-select: none;">微信授权登录</span>
                                </div>
                            </div>
                        </button>
                    </div> -->
                </div>
            </div>
        </div>
    </div>
    <div id="_processing" class="_processing">
        <img id="_processingIcon" style="width:16px;height:16px" src="/img/loading.gif">&nbsp;&nbsp;<span id="_processingText">加载中...</span>
    </div>
    <script src="js/jquery-1.10.2.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src='js/jquery.cookie.js'></script>
    <script src="js/jquery.placeholder.1.3.min.js"></script>
    <script src='js/system.js'></script>
    <script src='js/md5.js'></script>
    <script src="js/json.js"></script>
    <script src="js/locales.js"></script>
    <script src="js/wistorm/md5.js"></script>
    <script src="js/wistorm/define.js"></script>
    <script src="js/wistorm/wistorm.js"></script>
    <script>
        $(function () {
            // 判断浏览器版本
            // checkBrowser();

            //记住密码
            if ($.cookie("remeber") != "") {
                $("#remember").attr("checked", true);
                txtName = $.cookie("username");
                txtPwd = $.cookie("password");
                if (txtName != "" && txtName != null)
                    $("#username").val(txtName);
                else
                    $("#username").val("");
                if (txtPwd != "" && txtPwd != null)
                    $("#password").val(txtPwd);
                else
                    $("#password").val("");

            }

            //首次加载不显示ValidateCode 当ajax请求失败加载(利用ValidateCode所在样式是否存在来判断)
            var _btnClick;
            $("#btnLogin").click(function () {
                _btnClick = $(this);
                $(this).button('loading');
                // return;
                if ($("#username").val() == "") {
                    $(this).button('reset');
                    _alert(i18next.t("login.input_username"));
                    return;
                } else if ($("#password").val() == "") {
                    $(this).button('reset');
                    _alert(i18next.t("login.input_password"));
                    return;
                } else {
                    txtName = $("#username").val();
                    txtPwd = hex_md5($("#password").val());
                }

                if ($("#remember").is(":checked")) {
                    $.cookie("remeber", true, { expires: 7 });
                    $.cookie("username", $("#username").val(), { expires: 7 });
                    $.cookie("password", $("#password").val(), { expires: 7 });
                }
                else {
                    $.cookie("remeber", false, { expires: 7 });
                    $.cookie("username", "");
                    $.cookie("password", "");
                }

                var logUrl = "/cardQueryLoginAndSave";
                // debugger
                var logData = { username: txtName, password: txtPwd };
                var obj = { type: "GET", url: logUrl, data: logData, success: success, error: error };
                ajax_function(obj);
            });

            //登录成功后保存密码和用户名
            var success = function (json) {
                _btnClick.button('reset');
                if (json === null) {
                    _alert(i18next.t("login.err_msg"));
                    clearLogin();
                }
                else if (json.status_code == 0) {
                    $.cookie('adminUser', json.adminUser)
                    $.cookie('username', $("#username").val());
                    $.cookie('auth_code', json.access_token);
                    $.cookie('dealer_id', json.uid);
                    $.cookie('parent_id', json.pid || '');
                    $.cookie('dealer_type', json.user_type);
                    $.cookie('lang', 'zh-CN');
                    location.href = '/cardQuery';


                } else if (json.status_code == 1) {
                    _alert(i18next.t("login.wrong_username"));
                    clearLogin();
                } else if (json.status_code == 2) {
                    _alert(i18next.t("login.wrong_password"));
                    clearLogin();
                } else if (json.status_code == 3) {
                    _alert(i18next.t("login.no_right"));
                    clearLogin();
                } else {
                    _alert(i18next.t("msg.err-execption") + "[code=" + json.status_code + "]");
                    clearLogin();
                }
            };

            var error = function OnError(XMLHttpRequest, textStatus, errorThrown) {
                _btnClick.button('reset');
                if (errorThrown || textStatus == "error" || textStatus == "parsererror" || textStatus == "notmodified") {
                    _alert("服务器连接异常，请检查网络。");
                    clearLogin();
                    return;
                }
                if (textStatus == "timeout") {
                    _alert("网络连接超时，请检查网络");
                    clearLogin();
                }
            };


        });
    </script>
</body>

</html>